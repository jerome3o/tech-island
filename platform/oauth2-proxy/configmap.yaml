apiVersion: v1
kind: ConfigMap
metadata:
  name: oauth2-proxy-config
  namespace: oauth2-proxy
data:
  # OAuth2 Proxy configuration
  # Full reference: https://oauth2-proxy.github.io/oauth2-proxy/docs/configuration/overview

  # Provider configuration
  OAUTH2_PROXY_PROVIDER: "google"
  OAUTH2_PROXY_PROVIDER_DISPLAY_NAME: "Google"

  # Cookie configuration
  OAUTH2_PROXY_COOKIE_NAME: "_oauth2_proxy"
  OAUTH2_PROXY_COOKIE_SECURE: "true"
  OAUTH2_PROXY_COOKIE_HTTPONLY: "true"
  OAUTH2_PROXY_COOKIE_SAMESITE: "lax"
  OAUTH2_PROXY_COOKIE_EXPIRE: "168h"  # 7 days
  OAUTH2_PROXY_COOKIE_REFRESH: "60m"  # Refresh session every hour

  # Email domain restrictions
  # Set to "*" to allow any Google account, or specify domains
  OAUTH2_PROXY_EMAIL_DOMAINS: "*"

  # URLs
  OAUTH2_PROXY_UPSTREAMS: "static://200"  # We use auth-request mode
  OAUTH2_PROXY_REVERSE_PROXY: "true"

  # Logging
  OAUTH2_PROXY_LOGGING_FILENAME: ""  # Log to stdout
  OAUTH2_PROXY_STANDARD_LOGGING: "true"
  OAUTH2_PROXY_AUTH_LOGGING: "true"
  OAUTH2_PROXY_REQUEST_LOGGING: "true"

  # Pass user info to upstream
  OAUTH2_PROXY_SET_XAUTHREQUEST: "true"
  OAUTH2_PROXY_PASS_ACCESS_TOKEN: "false"
  OAUTH2_PROXY_PASS_USER_HEADERS: "true"

  # Use email instead of user ID
  OAUTH2_PROXY_PREFER_EMAIL_TO_USER: "true"

  # Skip auth for health checks
  OAUTH2_PROXY_SKIP_AUTH_ROUTES: "GET=^/health$,GET=^/ping$"

  # HTTP configuration
  OAUTH2_PROXY_HTTP_ADDRESS: "0.0.0.0:4180"
  OAUTH2_PROXY_METRICS_ADDRESS: "0.0.0.0:44180"
